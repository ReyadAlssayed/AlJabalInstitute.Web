@page "/"
@layout AuthLayout
@rendermode InteractiveServer

@using System.Net.Http.Json
@using AlJabalInstitute.Web.Services

@inject NavigationManager Nav
@inject ToastService ToastSvc
@inject IJSRuntime JS


<div class="student-auth-shell">

    <div class="student-auth-page">
        <div class="student-auth-card">

            <div class="auth-header">
                <div class="auth-header-content">
                    <h1>الجبل العالي</h1>
                </div>
            </div>

            <div class="student-auth-body">

                <div class="field">
                    <input placeholder="أدخل الرقم الوطني"
                           inputmode="numeric"
                           maxlength="20"
                           @bind="NationalId" />
                </div>

                <div class="field">
                    <input type="@PasswordInputType"
                           placeholder="أدخل كلمة السر"
                           maxlength="50"
                           @bind="Password" />

                    <button type="button"
                            class="field-action"
                            @onclick="TogglePassword">
                        @PasswordToggleText
                    </button>
                </div>

                <button class="primary-btn"
                        @onclick="DoLogin">
                    تسجيل الدخول
                </button>

            </div>
        </div>
    </div>

</div>

@code {
    string NationalId = "";
    string Password = "";

    bool ShowPassword = false;

    string PasswordInputType => ShowPassword ? "text" : "password";
    string PasswordToggleText => ShowPassword ? "إخفاء" : "إظهار";

    void TogglePassword() => ShowPassword = !ShowPassword;

    async Task DoLogin()
    {
        var r = await JS.InvokeAsync<LoginJsResult>("studentLogin", NationalId, Password);

        if (!r.ok)
        {
            ToastSvc.Error(string.IsNullOrWhiteSpace(r.text) ? "بيانات الدخول غير صحيحة" : r.text);
            return;
        }

        ToastSvc.Success("تم تسجيل الدخول بنجاح");
        Nav.NavigateTo("/Student/Home", true);
    }

    public class LoginJsResult
    {
        public bool ok { get; set; }
        public string? text { get; set; }
    }

}
