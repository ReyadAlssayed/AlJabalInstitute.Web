@page "/"
@using AlJabalInstitute.Web.Services
@layout AuthLayout
@rendermode InteractiveServer
@inject NavigationManager Nav
@inject StudentAuthService AuthService

<div class="student-auth-shell">

    <div class="student-auth-page">
        <div class="student-auth-card">

            <div class="auth-header">
                <div class="auth-header-content">
                    <h1>الجبل العالي</h1>
                </div>
            </div>

            <div class="student-auth-body">

                <div class="field">
                    <input placeholder="أدخل الرقم الوطني"
                           inputmode="numeric"
                           maxlength="20"
                           @bind="NationalId" />
                </div>

                <div class="field">
                    <input type="@PasswordInputType"
                           placeholder="أدخل كلمة السر"
                           maxlength="50"
                           @bind="Password" />

                    <button type="button"
                            class="field-action"
                            @onclick="TogglePassword">
                        @PasswordToggleText
                    </button>
                </div>

                <button class="primary-btn"
                        @onclick="DoLogin">
                    تسجيل الدخول
                </button>

                @if (!string.IsNullOrEmpty(Error))
                {
                    <p style="color:red;margin-top:10px">@Error</p>
                }

            </div>
        </div>
    </div>

</div>

@code {
    string NationalId = "";
    string Password = "";
    string Error = "";

    bool ShowPassword = false;

    string PasswordInputType => ShowPassword ? "text" : "password";
    string PasswordToggleText => ShowPassword ? "إخفاء" : "إظهار";

    void TogglePassword()
        => ShowPassword = !ShowPassword;

    async Task DoLogin()
    {
        Error = "";

        var result = await AuthService.Login(NationalId, Password);

        if (!result.Success)
        {
            Error = result.Message;
            return;
        }

        Nav.NavigateTo("/Student/Home");
    }
}
